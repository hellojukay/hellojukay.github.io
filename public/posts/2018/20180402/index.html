<!DOCTYPE html>
<html lang="en-us"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
   <meta name="description" content="今天干了件大事：把测试环境的机器搞死机了。事情的发展顺序是这样的：有人向我反馈jenkins编译速度特别慢，我打开jenkins一看，好多任务都没有执行完，打开jenkins的过程是非常缓慢，想到早上仿真环境网络的问题，我下意识的认为是今天的网络太慢了。我登录baochai试一下，发现登录服务竟然需要10秒钟之久，ls回显也很慢。这个时候在钉钉上联系运维的同学，我说baochai的网络特别慢，运维的同学去机房找原因，半小时未果，突然钉钉里有测试的同学发了一条消息，说baochai的cpu占用非常高，这个时候运维的同学在群里发了一张截图，说是有条bash命令占用了83G的内存，服务器濒临司机。于是赶紧kill了这个进程。一切恢复平静。大家都在讨论那条命令是在干什么，他们当时没有看就Kill了。后来我想起来了，我上午在服务器上执行了一条echo命令，当时卡死了，ctrl&#43;c也无法退出，于是我关闭了当前的iterm2会话窗口，没有当一回事，我没有想到我退出登录以后echo经常竟然没有自动退出，并且造成了这么大的影响。
echo [{&#34;id&#34;:188,&#34;cat&#34;:&#34;java&#34;,&#34;user&#34;:0,&#34;name&#34;:&#34;websocket-thrift-service&#34;,&#34;code&#34;:&#34;websocket-thrift-service&#34;,&#34;jdk&#34;:&#34;1.8&#34;,&#34;create_time&#34;:&#34;2018-02-02 09:52:23&#34;,&#34;update_time&#34;:&#34;2018-03-30 18:03:39&#34;},{&#34;id&#34;:117,&#34;cat&#34;:&#34;go&#34;,&#34;user&#34;:0,&#34;name&#34;:&#34;日志系统agent&#34;,&#34;code&#34;:&#34;plat-log-agent&#34;,&#34;jdk&#34;:&#34;&#34;,&#34;create_time&#34;:&#34;2017-09-28 19:22:32&#34;,&#34;update_time&#34;:&#34;2018-03-21 18:02:37&#34;},{&#34;id&#34;:204,&#34;cat&#34;:&#34;go&#34;,&#34;user&#34;:0,&#34;name&#34;:&#34;jaeger-agent&#34;,&#34;code&#34;:&#34;jaeger-agent&#34;,&#34;jdk&#34;:&#34;&#34;,&#34;create_time&#34;:&#34;2018-03-27 14:01:21&#34;,&#34;update_time&#34;:&#34;2018-03-27 14:01:21&#34;},{&#34;id&#34;:120,&#34;cat&#34;:&#34;tomcat&#34;,&#34;user&#34;:0,&#34;name&#34;:&#34;deploy_tmcat_test&#34;,&#34;code&#34;:&#34;deploy_tomcat_test&#34;,&#34;jdk&#34;:&#34;1.7&#34;,&#34;create_time&#34;:&#34;2017-09-29 16:16:16&#34;,&#34;update_time&#34;:&#34;2017-09-29 20:19:18&#34;},{&#34;id&#34;:102,&#34;cat&#34;:&#34;java&#34;,&#34;user&#34;:0,&#34;name&#34;:&#34;transferhook-service&#34;,&#34;code&#34;:&#34;transferhook-service&#34;,&#34;jdk&#34;:&#34;1.7&#34;,&#34;create_time&#34;:&#34;2017-09-28 19:22:31&#34;,&#34;update_time&#34;:&#34;2018-02-08 09:58:36&#34;},{&#34;id&#34;:183,&#34;cat&#34;:&#34;go&#34;,&#34;user&#34;:0,&#34;name&#34;:&#34;plat-log-agent-new&#34;,&#34;code&#34;:&#34;plat-log-agent-new&#34;,&#34;jdk&#34;:&#34;&#34;,&#34;create_time&#34;:&#34;2018-01-30 19:08:50&#34;,&#34;update_time&#34;:&#34;2018-01-30 19:56:20&#34;},{&#34;id&#34;:66,&#34;cat&#34;:&#34;java&#34;,&#34;user&#34;:0,&#34;name&#34;:&#34;carbooking_queue&#34;,&#34;code&#34;:&#34;carbooking_queue&#34;,&#34;jdk&#34;:&#34;1.7&#34;,&#34;create_time&#34;:&#34;2017-09-28 19:22:30&#34;,&#34;update_time&#34;:&#34;2017-09-29 09:35:52&#34;}] 在我看来这是条在普通不过的echo命令了，我的本意是重定向这条json到underscore，格式化这条json。没想到会造成服务器司机。这里的原因是没有给字符串加上引号，造成了自动的排列组合。他的原理如下：
&#39;-&gt;$ echo [{1,2,3},{a,b,c}] [1,a] [2,a] [3,a] [1,b] [2,b] [3,b] [1,c] [2,c] [3,c] ">  

  <title>
    
      不为人知的echo黑魔法
    
  </title>


  <link rel="shortcut icon" type="image/x-icon" href="/" />
  
  
  
  <link rel="stylesheet" href="/css/main.01273a70fa873b012d056499c16bb47955e0e7526c34edb73f05ca8f99f488ebc323423c6557f93f9b42a41de0448a25ce9a1ab577d0bf61e36eaf52a4979a1d.css" integrity="sha512-ASc6cPqHOwEtBWSZwWu0eVXg51JsNO23PwXKj5n0iOvDI0I8ZVf5P5tCpB3gRIolzpoatXfQv2Hjbq9SpJeaHQ==" />
  
</head>
<body a="auto">
        <main class="page-content" aria-label="Content">
            <div class="w">
<a href="/">..</a>


<article>
    <p class="post-meta">
        <time datetime="2018-04-02 15:43:00 &#43;0000 UTC">
            2018-04-02
        </time>
    </p>

    <h1>不为人知的echo黑魔法</h1>

    

    <p>今天干了件大事：把测试环境的机器搞死机了。事情的发展顺序是这样的：有人向我反馈jenkins编译速度特别慢，我打开jenkins一看，好多任务都没有执行完，打开jenkins的过程是非常缓慢，想到早上仿真环境网络的问题，我下意识的认为是今天的网络太慢了。我登录baochai试一下，发现登录服务竟然需要10秒钟之久，ls回显也很慢。这个时候在钉钉上联系运维的同学，我说baochai的网络特别慢，运维的同学去机房找原因，半小时未果，突然钉钉里有测试的同学发了一条消息，说baochai的cpu占用非常高，这个时候运维的同学在群里发了一张截图，说是有条bash命令占用了83G的内存，服务器濒临司机。于是赶紧kill了这个进程。一切恢复平静。大家都在讨论那条命令是在干什么，他们当时没有看就Kill了。后来我想起来了，我上午在服务器上执行了一条echo命令，当时卡死了，ctrl+c也无法退出，于是我关闭了当前的iterm2会话窗口，没有当一回事，我没有想到我退出登录以后echo经常竟然没有自动退出，并且造成了这么大的影响。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>echo <span style="color:#f92672">[{</span><span style="color:#e6db74">&#34;id&#34;</span>:188,<span style="color:#e6db74">&#34;cat&#34;</span>:<span style="color:#e6db74">&#34;java&#34;</span>,<span style="color:#e6db74">&#34;user&#34;</span>:0,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;websocket-thrift-service&#34;</span>,<span style="color:#e6db74">&#34;code&#34;</span>:<span style="color:#e6db74">&#34;websocket-thrift-service&#34;</span>,<span style="color:#e6db74">&#34;jdk&#34;</span>:<span style="color:#e6db74">&#34;1.8&#34;</span>,<span style="color:#e6db74">&#34;create_time&#34;</span>:<span style="color:#e6db74">&#34;2018-02-02 09:52:23&#34;</span>,<span style="color:#e6db74">&#34;update_time&#34;</span>:<span style="color:#e6db74">&#34;2018-03-30 18:03:39&#34;</span><span style="color:#f92672">}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;id&#34;</span>:117,<span style="color:#e6db74">&#34;cat&#34;</span>:<span style="color:#e6db74">&#34;go&#34;</span>,<span style="color:#e6db74">&#34;user&#34;</span>:0,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;日志系统agent&#34;</span>,<span style="color:#e6db74">&#34;code&#34;</span>:<span style="color:#e6db74">&#34;plat-log-agent&#34;</span>,<span style="color:#e6db74">&#34;jdk&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#e6db74">&#34;create_time&#34;</span>:<span style="color:#e6db74">&#34;2017-09-28 19:22:32&#34;</span>,<span style="color:#e6db74">&#34;update_time&#34;</span>:<span style="color:#e6db74">&#34;2018-03-21 18:02:37&#34;</span><span style="color:#f92672">}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;id&#34;</span>:204,<span style="color:#e6db74">&#34;cat&#34;</span>:<span style="color:#e6db74">&#34;go&#34;</span>,<span style="color:#e6db74">&#34;user&#34;</span>:0,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;jaeger-agent&#34;</span>,<span style="color:#e6db74">&#34;code&#34;</span>:<span style="color:#e6db74">&#34;jaeger-agent&#34;</span>,<span style="color:#e6db74">&#34;jdk&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#e6db74">&#34;create_time&#34;</span>:<span style="color:#e6db74">&#34;2018-03-27 14:01:21&#34;</span>,<span style="color:#e6db74">&#34;update_time&#34;</span>:<span style="color:#e6db74">&#34;2018-03-27 14:01:21&#34;</span><span style="color:#f92672">}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;id&#34;</span>:120,<span style="color:#e6db74">&#34;cat&#34;</span>:<span style="color:#e6db74">&#34;tomcat&#34;</span>,<span style="color:#e6db74">&#34;user&#34;</span>:0,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;deploy_tmcat_test&#34;</span>,<span style="color:#e6db74">&#34;code&#34;</span>:<span style="color:#e6db74">&#34;deploy_tomcat_test&#34;</span>,<span style="color:#e6db74">&#34;jdk&#34;</span>:<span style="color:#e6db74">&#34;1.7&#34;</span>,<span style="color:#e6db74">&#34;create_time&#34;</span>:<span style="color:#e6db74">&#34;2017-09-29 16:16:16&#34;</span>,<span style="color:#e6db74">&#34;update_time&#34;</span>:<span style="color:#e6db74">&#34;2017-09-29 20:19:18&#34;</span><span style="color:#f92672">}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;id&#34;</span>:102,<span style="color:#e6db74">&#34;cat&#34;</span>:<span style="color:#e6db74">&#34;java&#34;</span>,<span style="color:#e6db74">&#34;user&#34;</span>:0,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;transferhook-service&#34;</span>,<span style="color:#e6db74">&#34;code&#34;</span>:<span style="color:#e6db74">&#34;transferhook-service&#34;</span>,<span style="color:#e6db74">&#34;jdk&#34;</span>:<span style="color:#e6db74">&#34;1.7&#34;</span>,<span style="color:#e6db74">&#34;create_time&#34;</span>:<span style="color:#e6db74">&#34;2017-09-28 19:22:31&#34;</span>,<span style="color:#e6db74">&#34;update_time&#34;</span>:<span style="color:#e6db74">&#34;2018-02-08 09:58:36&#34;</span><span style="color:#f92672">}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;id&#34;</span>:183,<span style="color:#e6db74">&#34;cat&#34;</span>:<span style="color:#e6db74">&#34;go&#34;</span>,<span style="color:#e6db74">&#34;user&#34;</span>:0,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;plat-log-agent-new&#34;</span>,<span style="color:#e6db74">&#34;code&#34;</span>:<span style="color:#e6db74">&#34;plat-log-agent-new&#34;</span>,<span style="color:#e6db74">&#34;jdk&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#e6db74">&#34;create_time&#34;</span>:<span style="color:#e6db74">&#34;2018-01-30 19:08:50&#34;</span>,<span style="color:#e6db74">&#34;update_time&#34;</span>:<span style="color:#e6db74">&#34;2018-01-30 19:56:20&#34;</span><span style="color:#f92672">}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;id&#34;</span>:66,<span style="color:#e6db74">&#34;cat&#34;</span>:<span style="color:#e6db74">&#34;java&#34;</span>,<span style="color:#e6db74">&#34;user&#34;</span>:0,<span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;carbooking_queue&#34;</span>,<span style="color:#e6db74">&#34;code&#34;</span>:<span style="color:#e6db74">&#34;carbooking_queue&#34;</span>,<span style="color:#e6db74">&#34;jdk&#34;</span>:<span style="color:#e6db74">&#34;1.7&#34;</span>,<span style="color:#e6db74">&#34;create_time&#34;</span>:<span style="color:#e6db74">&#34;2017-09-28 19:22:30&#34;</span>,<span style="color:#e6db74">&#34;update_time&#34;</span>:<span style="color:#e6db74">&#34;2017-09-29 09:35:52&#34;</span><span style="color:#f92672">}]</span>
</span></span></code></pre></div><p>在我看来这是条在普通不过的echo命令了，我的本意是重定向这条json到underscore，格式化这条json。没想到会造成服务器司机。这里的原因是没有给字符串加上引号，造成了自动的排列组合。他的原理如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">&#39;</span>-&gt;$ echo <span style="color:#f92672">[{</span>1,2,3<span style="color:#f92672">}</span>,<span style="color:#f92672">{</span>a,b,c<span style="color:#f92672">}]</span>                                            
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>1,a<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>2,a<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>3,a<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>1,b<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>2,b<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>3,b<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>1,c<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>2,c<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>3,c<span style="color:#f92672">]</span>
</span></span></code></pre></div>
</article>

            </div>
        </main>
    </body></html>
