<!DOCTYPE html>
<html lang="en-us"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
   <meta name="description" content="默认情况下使用docker官方的yum源来安装docker,因为网络下载慢，所以非常耗时。还好阿里云提供了yum镜像功能，所以我们能使用阿里云的yum源来加速我们的docker安装。使用方式如下：
删除已经安装的docker工具 sudo yum remove docker \ docker-client \ docker-client-latest \ docker-common \ docker-latest \ docker-latest-logrotate \ docker-logrotate \ docker-selinux \ docker-engine-selinux \ docker-engine 安装部分依赖工具 sudo yum install -y yum-utils device-mapper-persistent-data lvm2 添加阿里云yum源 sudo wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo 查看所有的docker包 bash-4.2$ yum list docker-ce --showduplicates Loaded plugins: fastestmirror Determining fastest mirrors elasticsearch-6.x 405/405 Installed Packages docker-ce.x86_64 18.06.0.ce-3.el7 @docker-ce-stable Available Packages docker-ce.x86_64 17.03.0.ce-1.el7.centos docker-ce-stable docker-ce.x86_64 17.03.1.ce-1.el7.centos docker-ce-stable docker-ce.x86_64 17.">  

  <title>
    
      使用aliyun的yum仓库安装docker
    
  </title>


  <link rel="shortcut icon" type="image/x-icon" href="/" />
  
  
  
  <link rel="stylesheet" href="/css/main.01273a70fa873b012d056499c16bb47955e0e7526c34edb73f05ca8f99f488ebc323423c6557f93f9b42a41de0448a25ce9a1ab577d0bf61e36eaf52a4979a1d.css" integrity="sha512-ASc6cPqHOwEtBWSZwWu0eVXg51JsNO23PwXKj5n0iOvDI0I8ZVf5P5tCpB3gRIolzpoatXfQv2Hjbq9SpJeaHQ==" />
  
</head>
<body a="auto">
        <main class="page-content" aria-label="Content">
            <div class="w">
<a href="/">..</a>


<article>
    <p class="post-meta">
        <time datetime="2019-02-27 00:00:00 &#43;0000 UTC">
            2019-02-27
        </time>
    </p>

    <h1>使用aliyun的yum仓库安装docker</h1>

    

    <p>默认情况下使用docker官方的yum源来安装docker,因为网络下载慢，所以非常耗时。还好阿里云提供了yum镜像功能，所以我们能使用阿里云的yum源来加速我们的docker安装。使用方式如下：</p>
<ol>
<li>删除已经安装的docker工具</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo yum remove docker <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                  docker-client <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                  docker-client-latest <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                  docker-common <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                  docker-latest <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                  docker-latest-logrotate <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                  docker-logrotate <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                  docker-selinux <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                  docker-engine-selinux <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                  docker-engine
</span></span></code></pre></div><ol start="2">
<li>安装部分依赖工具</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo yum install -y yum-utils device-mapper-persistent-data lvm2
</span></span></code></pre></div><ol start="3">
<li>添加阿里云yum源</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
</span></span><span style="display:flex;"><span>sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</span></span></code></pre></div><ol start="4">
<li>查看所有的docker包</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>bash-4.2$ yum list docker-ce --showduplicates
</span></span><span style="display:flex;"><span>Loaded plugins: fastestmirror
</span></span><span style="display:flex;"><span>Determining fastest mirrors
</span></span><span style="display:flex;"><span>elasticsearch-6.x                                                                                                      405/405
</span></span><span style="display:flex;"><span>Installed Packages
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   18.06.0.ce-3.el7                                           @docker-ce-stable
</span></span><span style="display:flex;"><span>Available Packages
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   17.03.0.ce-1.el7.centos                                    docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   17.03.1.ce-1.el7.centos                                    docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   17.03.2.ce-1.el7.centos                                    docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   17.03.3.ce-1.el7                                           docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   17.06.0.ce-1.el7.centos                                    docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   17.06.1.ce-1.el7.centos                                    docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   17.06.2.ce-1.el7.centos                                    docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   17.09.0.ce-1.el7.centos                                    docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   17.09.1.ce-1.el7.centos                                    docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   17.12.0.ce-1.el7.centos                                    docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   17.12.1.ce-1.el7.centos                                    docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   18.03.0.ce-1.el7.centos                                    docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   18.03.1.ce-1.el7.centos                                    docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   18.06.0.ce-3.el7                                           docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   18.06.1.ce-3.el7                                           docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   18.06.2.ce-3.el7                                           docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   18.06.3.ce-3.el7                                           docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   3:18.09.0-3.el7                                            docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   3:18.09.1-3.el7                                            docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64                                   3:18.09.2-3.el7                                            docker-ce-stable
</span></span><span style="display:flex;"><span>-bash-4.2$
</span></span></code></pre></div><ol start="5">
<li>选择一个版本，安装它</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo yum install docker-ce-18.03.0.ce
</span></span></code></pre></div><ol start="6">
<li>如果是需要安装最新版本，则不需要指定版本</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo yum install docker-ce
</span></span></code></pre></div><ol start="7">
<li>将docker加入到服务</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>systemctl enable docker
</span></span></code></pre></div><ol start="8">
<li>启动docker服务</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>systemctl start docker
</span></span></code></pre></div><ol start="9">
<li>完成</li>
</ol>
<h2 id="2019年3月03日更新">2019年3月03日更新</h2>
<p>docker-ce-18.09.0.ce版本，也就是2018-09版本取消了对TLS 1.2的支持，无法登录artifactory仓库。</p>
<h2 id="2019年4月16日更新">2019年4月16日更新</h2>
<p>添加阿里云镜像加速的方式，编辑 <code>/etc/docker/daemon.json</code>, 如果文件不存在，那么创建这个文件，加入如下内容:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#34;registry-mirrors&#34;</span>: <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;https://registry.docker-cn.com&#34;</span><span style="color:#f92672">]}</span>
</span></span></code></pre></div><p>或者</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;registry-mirrors&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;https://registry.docker-cn.com&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;http://hub-mirror.c.163.com&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;https://docker.mirrors.ustc.edu.cn&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>然后重启<code>docker</code>服务</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>systemctl restart docker
</span></span></code></pre></div><h2 id="2020年01月02日更新">2020年01月02日更新</h2>
<p>centos repo 参考： <a href="http://mirrors.aliyun.com/repo/">http://mirrors.aliyun.com/repo/</a></p>
<h2 id="2020年07月08日更新">2020年07月08日更新</h2>
<p>docker 设置 driver 为 systemd, 设置 <code>/etc/docker/daemon.json</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">cat</span> <span style="color:#960050;background-color:#1e0010">&gt;</span> <span style="color:#960050;background-color:#1e0010">/etc/docker/daemon.json</span> <span style="color:#960050;background-color:#1e0010">&lt;&lt;EOF</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;exec-opts&#34;</span>: [<span style="color:#e6db74">&#34;native.cgroupdriver=systemd&#34;</span>],
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;log-driver&#34;</span>: <span style="color:#e6db74">&#34;json-file&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;log-opts&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;max-size&#34;</span>: <span style="color:#e6db74">&#34;100m&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;storage-driver&#34;</span>: <span style="color:#e6db74">&#34;overlay2&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
</article>

            </div>
        </main>
    </body></html>
